let errorCount=3;function openDropDown(e){let t=document.querySelector("#alertsDropDown");t.style.display="block",t.scrollTop=2e3,socket.send(JSON.stringify(new Array("alerts"))),document.querySelector("#alerts").className="",document.addEventListener("click",clear),document.querySelector("#alertsDropDown").removeEventListener("click",openDropDown)}function clear(e){if("alertsDropDown"!==e.target.id&&"alerts"!=e.target.id&&-1===["check","X","subMessage","friendRequestMessage","standardMsg"].indexOf(e.target.className)){document.querySelector("#alertsDropDown").style.display="none";let e=document.querySelector("#alertsDropDown").children;for(let t=e.length-1;t>=0;t--)e[t].remove();document.querySelector("#alertsDropDown").addEventListener("click",openDropDown),document.removeEventListener("click",clear)}}function lightDarkMode(e){-1===document.querySelector(".messageBoxes").className.indexOf("invert_color")?(document.querySelector(".messageBoxes").className+=" invert_color",document.querySelector(".sidePanelFriends").className+=" invert_color",document.querySelector(".sidePanelSuggestions").className+=" invert_color",document.querySelector(".contact").className+=" invert_color",document.querySelector(".topMainPage").style.backgroundImage="linear-gradient(90deg, rgba(34, 6, 36), black)",document.body.style.backgroundColor="black",document.querySelector("#logout").className=" invert_color",document.querySelector(".talkingTo").style.backgroundImage="linear-gradient(90deg, #2c1c3b52, #18171a52)"):(reverseContrast(".messageBoxes"),reverseContrast(".sidePanelFriends"),reverseContrast(".sidePanelSuggestions"),reverseContrast(".contact"),document.body.style.backgroundColor="initial",document.querySelector(".topMainPage").style.backgroundImage="var(--navColor)",document.querySelector("#logout").className="",document.querySelector(".talkingTo").style.backgroundImage="var(--box)")}function reverseContrast(e){let t=document.querySelector(e),n=t.className;n=n.replace(" invert_color",""),t.className=n}function domLoad(){constantViewPort(),updateMessageBoxWidthAndHeight(),document.removeEventListener("DOMContentLoaded",domLoad)}function constantViewPort(){let e=window.pageX,t=window.pageY;document.querySelector("body").style.maxWidth=e+"px",document.querySelector("body").style.maxHeight=t+"px"}function updateMessageBoxWidthAndHeight(e){const t=window.innerWidth,n=window.innerHeight,o=t*(7/8)-t*(1/8),r=n*(11/11.7)-n*(1/11.7);let s=document.querySelector("#history");document.querySelector(".messageBoxes").style.width=`${o}px`,document.querySelector(".messageBoxes").style.height=`${r}px`,s.scrollTop=2e3}function switchChat(e){const t=e.target.textContent;let n=document.querySelector("#friendBox").children;for(const e of n)e.style.fontSize="initial",e.style.fontWeight="initial";e.target.style.fontWeight="bold",e.target.style.fontSize="2em",document.querySelector(".talkingTo").textContent=t,socket.send(JSON.stringify(new Array("changeChat",t)))}function addFriend(e){const t=e.target.textContent;var n=document.querySelector(".suggestionBox").children,o=document.querySelector("#friendBox").children;let r=[],s=[],c=[];for(let e=n.length-1;e>=0;e--)"addFriendBox"!==n[e].className?(n[e].textContent===t&&c.push(n[e]),r.push(n[e].textContent)):n[e].remove();for(const e of o)s.push(e.textContent);let d=e.pageX,l=e.pageY,a=document.createElement("button"),i=.07*window.innerWidth;if(a.style.left=d+"px",a.style.top=l+"px",a.className="addFriendBox",a.textContent="Add Friend",i+d<=window.innerWidth){c[0].insertAdjacentElement("afterend",a),a.addEventListener("click",(()=>{socket.send(JSON.stringify(new Array("newAlerts",t,r,s)))}));let e=document.querySelector(".messageHistory"),n=document.querySelector(".sidePanelSuggestions"),o=document.querySelector(".sidePanelFriends"),d=document.querySelector(".topMainPage"),l=document.querySelector(".contact");e.addEventListener("click",removeAddFriendBox),o.addEventListener("click",removeAddFriendBox),d.addEventListener("click",removeAddFriendBox),l.addEventListener("click",removeAddFriendBox),n.addEventListener("click",removeAddFriendBox1)}}function removeAddFriend(){var e=document.querySelector(".suggestionBox").children;for(let t=e.length-1;t>=0;t--)if("addFriendBox"===e[t].className){e[t].remove();break}}function removeAddFriendBox1(e){if("suggestionBox"===e.target.className){document.querySelector(".sidePanelSuggestions").removeEventListener("click",removeAddFriendBox1),removeAddFriend()}}function removeAddFriendBox(e){removeAddFriend();let t=document.querySelector(".messageHistory"),n=document.querySelector(".sidePanelFriends"),o=document.querySelector(".topMainPage"),r=document.querySelector(".contact");t.removeEventListener("click",removeAddFriendBox),n.removeEventListener("click",removeAddFriendBox),o.removeEventListener("click",removeAddFriendBox),r.removeEventListener("click",removeAddFriendBox)}document.addEventListener("DOMContentLoaded",domLoad),window.addEventListener("resize",(e=>{updateMessageBoxWidthAndHeight()})),document.addEventListener("DOMContentLoaded",(e=>{let t=document.querySelector("body").children;for(let e=t.length-1;e>0;e--)if("position: static !important;"===t[e].style.cssText){t[e].remove();break}})),document.addEventListener("DOMContentLoaded",(()=>{let e=new XMLHttpRequest;e.open("POST","./app.js"),e.send(JSON.stringify(new Array("return"))),e.onload=()=>{let t=e.responseText.slice(e.responseText.indexOf("=")+1),n=e.responseText.indexOf(";");-1!==n&&(t=e.responseText.slice(e.responseText.indexOf("=")+1,n)),0!=t.length?document.querySelector("body").insertAdjacentHTML("beforeend",`<input type='hidden' name='csrf' content="${t}">`):document.location.href="/"}})),document.querySelector("#logout").addEventListener("click",(e=>{const t=new XMLHttpRequest;t.open("POST","./app.js"),t.onload=()=>{socket.close(),document.location.href="./"},t.send(JSON.stringify(new Array("clearEverything")))})),document.querySelector("#settings").addEventListener("click",(e=>{document.location.href="./settings.html"})),document.querySelector("#alerts").addEventListener("click",openDropDown),document.querySelector("#switchmodes").addEventListener("click",lightDarkMode),document.querySelector("#textbox").addEventListener("onkeydown",(e=>{for(let t=20;e.value.length%20==0;t+=20)e.value=e.value.slice(0,t)+"\n"+e.value.slice(t+1)})),document.querySelector("#search").addEventListener("keyup",(e=>{let t=document.querySelector("#search").value;t.trim(),/[-$\%^\&\*(){}[\]"'\?\><,.\+=_@!#;\:|\\]/.test(t)?(errorCount<=0&&(alert("Byebye bitch"),localStorage.clear(),document.location.href="./IntroHTML.html"),alert(`Invalid Character: ${errorCount} warnings left`),document.querySelector("#search").value="",errorCount-=1):socket.send(JSON.stringify(new Array("searching",t)))}));const socket=new WebSocket("wss://yourvoid.herokuapp.com/MessageHTML.html");function addFriendRequestDiv(e,t,n){let o=document.querySelector(".suggestionBox").children,r=document.querySelector("#friendBox").children,s=[],c=[];for(const e of o)s.push(e.textContent);for(const e of r)c.push(e.textContent);document.querySelector(e).insertAdjacentHTML("beforeend","<div class='friendRequestMessage'></div>"),document.querySelector(e).lastElementChild.insertAdjacentHTML("beforeend","<button class='subMessage'></button>"),document.querySelector(e).lastElementChild.lastElementChild.textContent=t,document.querySelector(e).lastElementChild.insertAdjacentHTML("beforeend","<button class='check'> ✔ </button>"),document.querySelector(e).lastElementChild.lastElementChild.addEventListener("click",(e=>{socket.send(JSON.stringify(new Array("addFriend",n,s,c)));let t=document.querySelector("#alertDropDown").children;if(void 0!==t){for(const e in t)if(-1!==e.textContent.indexOf(n)){e.remove(),document.querySelector("#alertDropDown").insertAdjacentHTML("beforeend",`<button class=standardMsg> ${n} is now your friend. </button>`);break}}else document.querySelector("#alertDropDown").insertAdjacentHTML("beforeend",`<button class=standardMsg> ${n} is now your friend </button>`)})),document.querySelector(e).lastElementChild.insertAdjacentHTML("beforeend","<button class='X'> ❌ </div>"),document.querySelector(e).lastElementChild.lastElementChild.addEventListener("click",(e=>{socket.send(JSON.stringify(new Array("rejectFriend",n)))}))}function checkEnter(e){if("Enter"==e.code&&document.querySelector("#textbox").value.length>0){let e=document.querySelector("#textbox");const t=e.value;e.value="",socket.send(JSON.stringify(new Array("msg",t)))}}function checkForTypeInSearch(e){}function errorMsg(e){const t=document.querySelector("#err1");t.textContent="The Username or Password provided does not match";const n=document.querySelector("#existUsername"),o=document.querySelector("#existPass");n.addEventListener("click",(e=>{t.textContent="",n.removeEventListener()})),o.addEventListener("click",(e=>{t.textContent="",o.removeEventListener()}))}socket.onopen=e=>{socket.send(JSON.stringify(new Array("begin")))},socket.onmessage=e=>{let t=JSON.parse(e.data),n=t[0],o=t.slice(1);switch(n){case"curUser":document.querySelector("#user").textContent="Current User: "+o;break;case"friends":for(let e=0;e<o.length;e++)document.querySelector("#friendBox").insertAdjacentHTML("beforeend","<button type='button' class='aFriendPanel'> </button>"),document.querySelector("#friendBox").lastElementChild.textContent=o[e],document.querySelector("#friendBox").lastElementChild.addEventListener("click",switchChat);break;case"suggestions":for(let e=0;e<o.length;e++)document.querySelector(".suggestionBox").insertAdjacentHTML("beforeend","<button type='button' class='aSuggestionBox'> </button>"),document.querySelector(".suggestionBox").lastElementChild.textContent=o[e],document.querySelector(".suggestionBox").lastElementChild.addEventListener("click",addFriend);break;case"activeChat":let e=o[0],t=o.slice(1,2);document.querySelector("#user").textContent="Current User: "+e,o=o.slice(2);let n=document.querySelector(".messageHistory");if(o.length>0){let r=!0;for(let s=o.length-1;s>=0;s--){const c=o[s].Username,d=(o[s].uuid,o[s].timeSent,o[s].Content);if(r){const n=document.querySelector("#friendBox").children;for(const o of n)if(r&&""!=t&&o.textContent===c&&c!=e&&c===t){r=!1,o.style.fontWeight="bold",o.style.fontSize="2em";break}}""!==t&&(document.querySelector(".talkingTo").textContent=t),e===c?(n.insertAdjacentHTML("beforeend","<h3 class='aMessageBoxTo'> </h3>"),document.querySelector(".messageHistory").lastElementChild.textContent=d):(n.insertAdjacentHTML("beforeend","<h3 class='aMessageBoxFrom'></h3>"),n.lastElementChild.textContent=d),updateMessageBoxWidthAndHeight()}}break;case"msg":let l=o[0];o=o.slice(1);let a="";"me"===l?a='<h3 class="aMessageBoxFrom"> </h3>':"you"===l?a='<h3 class="aMessageBoxTo"> </h3>':p("error dumbass");const i=document.querySelector(".messageHistory");i.insertAdjacentHTML("beforeend",a),i.lastElementChild.textContent=o[0];break;case"changeChat":let u=document.querySelector(".messageHistory"),m=o[0];o=o.slice(1);let y=u.children;for(;0!=y.length;)y[0].remove();if(null!=o&&o.length>0){let e="";for(let t=o.length-1;t>=0;t--){const n=o[t].Username,r=o[t].uuid,s=(o[t].timeSent,o[t].Content);m!==r?(u.insertAdjacentHTML("beforeend","<h3 class='aMessageBoxTo'> </h3>"),document.querySelector(".messageHistory").lastElementChild.textContent=s,""===e&&(e=n)):(u.insertAdjacentHTML("beforeend","<h3 class='aMessageBoxFrom'></h3>"),u.lastElementChild.textContent=s)}""!==e&&""!==document.querySelector(".talkingTo").textContent&&(document.querySelector(".talkingTo").textContent=e)}updateMessageBoxWidthAndHeight();break;case"addFriend":let g=o[0],h=o[1];if(document.querySelector("#friendBox").insertAdjacentHTML("beforeend","<button class='aFriendPanel'> </button>"),document.querySelector("#friendBox").lastElementChild.textContent=g,void 0===h){var r=document.querySelector(".suggestionBox").children;for(const e of r)if(e.textContent===g){e.remove();break}}else{r=document.querySelector(".suggestionBox").children;for(const e of r)if(e.textContent===g){e.remove();break}let e=document.createElement("button");e.className="aSuggestionBox";var s=document.querySelector(".suggestionBox");s.appendChild(e),s.lastElementChild.textContent=h}removeAddFriend();break;case"addFriendOther":let f=o[0];o=o.slice(1);var c=document.querySelector(".suggestionBox").children,d=document.querySelector("#friendBox").children;let S=[],x=[],v=[];for(let e=c.length-1;e>=0;e--)"addFriendBox"!==c[e].className?(c[e].textContent===f&&v.push(c[e]),S.push(c[e].textContent)):c[e].remove();for(const e of d)x.push(e.textContent);socket.send(JSON.stringify(new Array("addFriendOther",f,S,x)));break;case"results":let q=document.querySelector(".suggestionBox").children;for(let e=q.length-1;e>=0;e--)q[e].remove();for(const e of o)document.querySelector(".suggestionBox").insertAdjacentHTML("beforeend","<button type='button' class='aSuggestionBox'></box>"),document.querySelector(".suggestionBox").lastElementChild.textContent=e.Username;break;case"newFriendRequestAlert1":let p=document.querySelector("#alertsDropDown"),b=o[1],C=o[0];"block"!==p.style.display&&(document.querySelector("#alerts").className="notification"),addFriendRequestDiv(p,C,b);break;case"newFriendRequestAlert0":document.querySelector("#alertsDropDown").insertAdjacentHTML("beforeend","<button class='standardMsg'></button>"),document.querySelector("#alertsDropDown").lastElementChild.textContent=o[0],"block"!==document.querySelector("#alertsDropDown").style.display&&(document.querySelector("#alerts").className="notification"),removeAddFriend();break;case"alerts":let k=document.querySelector("#alertsDropDown").children;for(let e=k.length-1;e>=0;e--)k[e].remove();let w=document.querySelector("#alertsDropDown");for(const e of o)"friend_request"===e.type?addFriendRequestDiv("#alertsDropDown",e.Content,e.Username):"standard"===e.type&&(w.insertAdjacentHTML("beforeend","<button class='standardMsg'></button>"),w.lastElementChild.textContent=e.Content);break;case"updateAlerts":let L=document.querySelector("#alertsDropDown").children;for(let e=L.length-1;e>=0;e--)L[e].remove();socket.send(JSON.stringify(new Array("alerts")));break;case"500x":document.location.href="./505.html"}},socket.onclose=e=>{const t=new XMLHttpRequest;t.open("POST","./app.js"),t.onload=()=>{-1===t.getAllResponseHeaders().indexOf("Cookie")&&(document.location.href="./")},t.send(JSON.stringify(new Array("authenticate")))},socket.onerror=e=>{throw e};
